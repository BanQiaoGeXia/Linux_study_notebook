<font size=4 color=green face="微软雅黑">

# 可移植性问题

---

## 1. 特性测试宏

+ 系统调用和库函数QPI的行为受各种标准的制约,
	+ Open Groups (SUS) 这样的标准机构来制定的
	+ 具有重要历史意义的两个UNIX实现 BSD和System V Release 4 

+ 编写可移植性应用程序时, 有事会希望各个头文件只显露遵循特定标准的定义, 需要在编译时定义一个或多个特性测试宏:
	+ 在程序源码包含任何头文件之前, 定义:
			# define _BSD_SOURCE
	
	+ 使用C编译器的-D选项
			
			$ cc -D_BSD_SOURCE prog.c

+ 特性测试宏:
		
		通过测试(使用 #if)应用程序为宏所定义的值, 实现可以决定应该让那些由头文件提供的特性可见

+ 以下特性测试宏由相关标准定义围城, 因而在支持这些标准的所有系统上, 对这些宏的使用都是可移植的:
	
名称|定义
-|-
_POSIX_SOURCE|已被_POSIC_C_SOURCE取代|
_POSIX_C_SOURCE|定义为1, 头文件汇贤楼符合 POSIX.1-1990 和 ISO C(1990)标准定义. <br>定义为大于 199309, 头文件还会显露村从 POSIX.1b(实时) 标准的定义, <br>若定义为大于定于199506, 变回开启对POSIX.1c(线程)定义的支持, <br>若定义为200112, 则开启对POSIX.1-2001基本规范(排除了XSI扩展)定义的支持. <br>若定义为200809, 会开启对POSIX.1-2008 基本规范定义的支持|
_XOPEN_SOURCE|一经定义, 头文件会显露对 POSIX.1/POSIX.2和X/Open(XPG4)标准的定义, <br>若大于等于500, 还会对SUSv2(UNIX98和XPG5)扩展的支持, <br>若大于等于600, 开启对SUSv3 XSI(UNIX 03)扩展和C99扩展的支持, <br>若大于等于700, 会开启对SUSv4 XSI扩展的支持|

+ glibc专用的特性测试宏

名称|定义
-|-
_SBD_SOURCE|一经定义, 开启对BSD定义的支持, 另外, 只要定义了该宏, 便以值199506定义了_POSIX_C_SOURCE, 当标准之间发生冲突是, 显示设置该宏会导致BSD定义倾斜|
_SVID_SOURCE|头文件会显露符合System V 接口规范(SVID)的定义|
_GNU_SOURCE|一经定义, 头文件会现楼符合前述所有标准的定义, 以及开启对各种GNU扩展定义的支持.
_POSIX_C_SOURCE|在POSIX.1-2001/SUSv3 中, 进队_POSIX_C_SOURCE和_XOPEN_SOURCE特性测试宏进行了明确定义, 应用程序要符合该标准, 应分别将上述两个宏定义为200112和600. <br>将_POSIX_C_SOURCE值定义为200112, 表示应用程序符合POSIX.1-2001基本规范. <br>将_XOPEN_SOURCE定义为600, 即表示应用程序符合SUSv3规范|
_XOPEN_SOURCE|同上|
POSIX.1/SUS|同上|

+ 函数原型中的特性测试宏

欲使某个特定常量定义或函数声明在头文件中可见, 应该定义一系列特性测试宏

编译时可采用缺省的GNU C语言编译器选项 或
		
	$ cc -std=c99 _D_XOPEN_SOURCE=600

为了能在以上两种方式编译的程序中编译通过, 在程序原型出需注明使用这些函数所必须定义的任何特性测试宏, 并在手册页中表明启用每一函数声明所需定义的特性测试宏


## 2. 系统数据类型

**不同实现的数据类型, 表示是均采用标准C语言类型, 尽管也有可能使用C语言的基本类型, 如 int, long, 来声明存储此类信息的变量, 但这一做法降低了不同UNIX系统间相互移植的难度**
	
+ 随着UNIX实现的不同, 有时甚至是同一实现中编译环境的不同, 一些基本数据类型的大小各不相同.
+ 不同实现可能会使用不同类型来表示相同信息
	+ 如: long型可能在系统A上长度为4字节, 在系统B上位8字节
	+ 进程ID在系统A上为int型, 在系统B上为long型
+ 即便是针对同一款UNIX实现, 用以表征信息的类型在不同版本之间也会有所不同
	+ 用户ID和组ID, 在linux2.2之前, 这些值以16位表示, linux2.4以后, 以32位表示


**为避免上述移植性问题, SUSv3规范了各种标准系统数据类型, 并要求各个实现适当加以定义和使用. 每种类型的定义均使用C语言的typedef特性**
	
+ pid_t数据类型用以表示进程ID 在Linux/x86-32上, 其定义为
		typedef int pid_t;
 
**标准系统数据类型中的大多数, 其命名均以_t 结尾. 其中的许多都声明与头文件<sys/types.h>中, 余下的少量则定义于其他头文件中**

**应用程序应采用这些类型定义来声明其使用的变量, 才能保证可移植性**

+ 

## 3. 其他可移植性问题